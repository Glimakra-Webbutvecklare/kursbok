# DOM-manipulation och Events: Interagera med Sidan\n\nJavaScript blir riktigt kraftfullt när vi använder det för att interagera med och ändra innehållet och strukturen på vår HTML-sida *efter* att den har laddats. Detta görs genom **DOM (Document Object Model)**. Vi behöver också kunna reagera på användarens handlingar, vilket vi gör genom att hantera **Events (Händelser)**.\n\n**Mål:** Förstå vad DOM är, lära oss hur man väljer ut (selectar) HTML-element med JavaScript, hur man manipulerar (ändrar) deras innehåll, attribut och stilar, samt hur man kopplar händelselyssnare (`addEventListener`) för att reagera på användarinteraktioner som klick.\n\n## Vad är DOM (Document Object Model)?\n\nNär en webbläsare laddar en HTML-sida skapar den en **modell** av sidans struktur i minnet. Denna modell kallas DOM. DOM representerar HTML-dokumentet som ett **träd av objekt (noder)**, där varje HTML-element (`<body>`, `<h1>`, `<p>`, `<div>`, etc.), textinnehåll och attribut blir ett objekt i trädet.\n\n```mermaid\ngraph TD\n    A[document] --> B(html);\n    B --> C(head);\n    B --> D(body);\n    C --> E(title);\n    E --> F[Text: \"Min Sida\"];\n    D --> G(h1);\n    G --> H[Text: \"Rubrik\"];\n    D --> I(p);\n    I --> J[Text: \"Paragraf..."];\n\n    style A fill:#ddd,stroke:#333,stroke-width:2px\n    style F fill:#fff,stroke:#ccc,stroke-width:1px\n    style H fill:#fff,stroke:#ccc,stroke-width:1px\n    style J fill:#fff,stroke:#ccc,stroke-width:1px\n```\n*Diagram: Förenklat exempel på DOM-trädet för en enkel HTML-sida.*\n\n**Varför är DOM viktigt?** JavaScript kan komma åt och **manipulera** detta DOM-träd. Det betyder att vi med JavaScript kan:\n\n*   Hitta specifika HTML-element.\n*   Ändra deras textinnehåll.\n*   Ändra deras attribut (som `src` på en bild eller `href` på en länk).\n*   Ändra deras CSS-stilar.\n*   Lägga till nya element.\n*   Ta bort befintliga element.\n\nAllt detta kan göras *utan att behöva ladda om sidan*. Det är grunden för dynamiska webbapplikationer.\n\n## Välja Element från DOM\n\nFör att kunna manipulera ett element måste vi först \"hitta\" det i DOM-trädet. Detta görs med olika metoder på det globala `document`-objektet:\n\n**Moderna Metoder (Rekommenderas):**\n\n*   **`document.querySelector(cssSelektor)`:**\n    *   Returnerar det **första** elementet i dokumentet som matchar den angivna CSS-selektorn (samma syntax som i CSS, t.ex. `#minId`, `.minKlass`, `p`, `nav > ul > li`).\n    *   Om ingen matchning hittas returneras `null`.\n    *   **Mycket flexibel och användbar!**\n        ```javascript\n        const mainHeading = document.querySelector('#main-title'); // Väljer element med id=\"main-title\"\n        const firstButton = document.querySelector('.btn'); // Väljer FÖRSTA elementet med class=\"btn\"\n        const navLink = document.querySelector('nav ul li a'); // Väljer första länken i en lista i nav\n        ```\n\n*   **`document.querySelectorAll(cssSelektor)`:**\n    *   Returnerar en **`NodeList`** (en samling som liknar en array) med **alla** element i dokumentet som matchar den angivna CSS-selektorn.\n    *   Om inga matchningar hittas returneras en tom `NodeList`.\n    *   Perfekt när du behöver arbeta med flera element av samma typ eller klass.\n        ```javascript\n        const allParagraphs = document.querySelectorAll('p');\n        const allButtons = document.querySelectorAll('.btn');\n\n        // Man kan iterera över en NodeList med forEach\n        allButtons.forEach(button => {\n          console.log(\"Hittade en knapp!\");\n          // Gör något med varje knapp här\n        });\n        ```\n\n**Äldre Metoder (Fortfarande vanliga, men mindre flexibla):**\n\n*   `document.getElementById(id)`: Returnerar elementet med det angivna ID:t (eller `null`).\n*   `document.getElementsByClassName(klassnamn)`: Returnerar en **`HTMLCollection`** (en *live*-samling, liknar array men inte exakt samma) med alla element som har den angivna klassen.\n*   `document.getElementsByTagName(taggnamn)`: Returnerar en **`HTMLCollection`** med alla element av den angivna taggtypen (t.ex. 'p', 'div').\n\n**Skillnad `NodeList` vs `HTMLCollection`:** En `NodeList` (från `querySelectorAll`) är oftast statisk, medan en `HTMLCollection` (från `getElementsByClassName/TagName`) är *live*, vilket betyder att den uppdateras automatiskt om DOM ändras. `NodeList` har också `forEach`-metoden inbyggd, vilket `HTMLCollection` ofta saknar (man behöver konvertera den till en array först för att använda `forEach`). För enkelhetens skull är `querySelector` och `querySelectorAll` oftast att föredra.\n\n## Manipulera Element\n\nNär du väl har valt ett eller flera element och sparat dem i en variabel, kan du ändra dem:\n\n*   **Ändra Textinnehåll:**\n    *   `element.textContent`: Hämtar eller sätter textinnehållet för ett element och dess ättlingar, *utan* HTML-taggar. Snabb och säker.\n    *   `element.innerText`: Liknar `textContent`, men tar hänsyn till CSS-styling (renderat utseende) och inkluderar inte text från dolda element. Används mer sällan.\n        ```javascript\n        const heading = document.querySelector('h1');\n        console.log(heading.textContent); // Visar nuvarande text\n        heading.textContent = \"Ny Rubrik från JS!\"; // Ändrar texten\n        ```\n\n*   **Ändra HTML-innehåll:**\n    *   `element.innerHTML`: Hämtar eller sätter HTML-koden *inuti* ett element. Kraftfullt, men **var försiktig!** Om du sätter `innerHTML` med text som kommer från en användare utan att sanera den, öppnar du upp för **Cross-Site Scripting (XSS)**-attacker.\n        ```javascript\n        const contentDiv = document.querySelector('#content');\n        // contentDiv.innerHTML = \"<h2>Nytt innehåll</h2><p>Detta är en paragraf.\";\n        // OBS: Använd med försiktighet, speciellt med osäker data!\n        ```\n\n*   **Ändra Attribut:**\n    *   `element.setAttribute('attributnamn', 'nyttVärde')`: Sätter värdet på ett attribut.\n    *   `element.getAttribute('attributnamn')`: Hämtar värdet på ett attribut.\n    *   För vanliga attribut som `id`, `src`, `href`, `class` kan man ofta komma åt dem direkt som egenskaper på element-objektet.\n        ```javascript\n        const link = document.querySelector('a');\n        link.href = \"https://www.google.com\"; // Ändrar href direkt\n        link.target = \"_blank\"; // Öppnas i ny flik\n\n        const image = document.querySelector('img');\n        image.setAttribute('src', 'nybild.jpg');\n        image.alt = \"Beskrivning av ny bild\"; // Ändrar alt direkt\n        ```\n\n*   **Ändra CSS-Stilar:**\n    *   `element.style.cssEgenskap = 'värde'`: Ändrar inline-stilen för ett element. CSS-egenskaper skrivs i **camelCase** (t.ex. `backgroundColor`, `fontSize`, `borderLeft`).\n        ```javascript\n        const box = document.querySelector('.box');\n        box.style.backgroundColor = 'lightblue';\n        box.style.padding = '20px';\n        box.style.border = '1px solid blue';\n        ```\n    *   **Bättre metod för större ändringar:** Ändra istället elementets klass med `element.classList`.\n        *   `element.classList.add('ny-klass')`: Lägger till en CSS-klass.\n        *   `element.classList.remove('gammal-klass')`: Tar bort en CSS-klass.\n        *   `element.classList.toggle('aktiv-klass')`: Lägger till klassen om den inte finns, tar bort den om den finns.\n        *   `element.classList.contains('viss-klass')`: Kollar om elementet har en viss klass (returnerar `true`/`false`).\n        ```css\n        /* I style.css */\n        .highlight {\n          background-color: yellow;\n          font-weight: bold;\n        }\n        ```\n        ```javascript\n        // I script.js\n        const importantText = document.querySelector('.important');\n        importantText.classList.add('highlight'); // Lägger till highlight-klassen\n        ```\n\n*   **Skapa och Lägga till Element:**\n    *   `document.createElement('taggnamn')`: Skapar ett nytt HTML-element (men lägger inte till det i DOM än).\n    *   `parentElement.appendChild(newElement)`: Lägger till `newElement` som det *sista* barnet till `parentElement`.\n    *   `parentElement.insertBefore(newElement, referenceElement)`: Infogar `newElement` före `referenceElement` inuti `parentElement`.\n    *   `element.remove()`: Tar bort elementet från DOM.\n        ```javascript\n        // Skapa ett nytt listelement (li)\n        const newItem = document.createElement('li');\n        newItem.textContent = \"Ny punkt\";\n\n        // Hitta listan (ul) och lägg till det nya elementet\n        const list = document.querySelector('#myList');\n        list.appendChild(newItem);\n        ```\n\n## Händelsehantering (Event Handling)\n\nEvents är händelser som inträffar i webbläsaren, oftast initierade av användaren (klick, tangenttryck, musrörelser) men också av webbläsaren själv (t.ex. att sidan laddats klart).\n\nJavaScript låter oss \"lyssna\" efter dessa händelser och köra en funktion (en **event handler** eller **callback function**) när händelsen inträffar.\n\n*   **`element.addEventListener(eventType, eventHandlerFunction)`:**\n    *   Den moderna och rekommenderade metoden för att koppla en händelselyssnare.\n    *   `eventType`: En sträng som anger vilken typ av händelse vi lyssnar efter (t.ex. `'click'`, `'mouseover'`, `'keydown'`, `'submit'`).\n    *   `eventHandlerFunction`: Funktionen som ska köras när händelsen inträffar. Denna funktion får automatiskt ett **event-objekt** som argument, vilket innehåller information om händelsen (t.ex. vilket element som klickades, vilken tangent som trycktes ner).\n\n    ```javascript\n    const myButton = document.querySelector('#myButton');\n\n    // Definiera en funktion som ska köras vid klick\n    function handleButtonClick(event) {\n      console.log(\"Knappen klickades!\");\n      console.log(\"Händelseobjekt:\", event); // Inspektera event-objektet i konsolen\n      // event.target refererar till elementet som utlöste händelsen (knappen)\n      event.target.textContent = \"Klickad!\";\n      event.target.style.backgroundColor = 'lightgreen';\n    }\n\n    // Koppla funktionen till knappens 'click'-händelse\n    myButton.addEventListener('click', handleButtonClick);\n\n    // Alternativt med en anonym arrow function direkt\n    const anotherButton = document.querySelector('#otherBtn');\n    anotherButton.addEventListener('click', (event) => {\n      console.log(\"Annan knapp klickad!\");\n      event.target.classList.toggle('active'); // Växla en klass\n    });\n    ```\n\n*   **Vanliga Händelsetyper:**\n    *   **Mus-händelser:** `click`, `dblclick`, `mouseover`, `mouseout`, `mousedown`, `mouseup`, `mousemove`\n    *   **Tangentbords-händelser:** `keydown`, `keyup`, `keypress`\n    *   **Formulär-händelser:** `submit` (på `<form>`-elementet), `input` (värde ändras i `<input>`, `<textarea>`), `change` (värde ändras och elementet tappar fokus), `focus`, `blur`\n    *   **Fönster/Dokument-händelser:** `load` (sidan och alla resurser laddats klart), `DOMContentLoaded` (HTML-trädet är byggt, körs före `load`), `resize`, `scroll`\n\n*   **`event.preventDefault()`:** Inuti en event handler-funktion kan du anropa `event.preventDefault()`. Detta förhindrar webbläsarens standardbeteende för händelsen. Används ofta för `submit`-händelsen på formulär för att stoppa sidan från att laddas om, så att JavaScript kan hantera datan istället (t.ex. skicka den med Fetch API).\n    ```javascript\n    const myForm = document.querySelector('#myForm');\n    myForm.addEventListener('submit', (event) => {\n      event.preventDefault(); // Stoppa standardformulärinskickning\n      console.log(\"Formulär skulle ha skickats, men vi stoppade det!\");\n      // Hämta formulärdata och gör något annat här...\n    });\n    ```\n\n## Sammanfattning\n\nDOM är webbläsarens representation av HTML-sidan som ett träd av objekt. JavaScript kan interagera med DOM för att:\n\n*   **Välja element:** Med `querySelector` (första matchningen) och `querySelectorAll` (alla matchningar) baserat på CSS-selektorer.\n*   **Manipulera element:** Ändra `textContent`, `innerHTML` (försiktigt!), attribut (`setAttribute`, direkta egenskaper), stilar (`element.style` eller, bättre, `element.classList`).\n*   **Skapa och ta bort element:** Med `createElement`, `appendChild`, `remove`.\n\n**Events** är händelser som inträffar i webbläsaren. Med `element.addEventListener('eventType', handlerFunction)` kan vi köra JavaScript-kod som svar på dessa händelser (t.ex. `click`), vilket gör våra sidor interaktiva. `event.preventDefault()` kan stoppa webbläsarens standardbeteende.\n\nAtt behärska DOM-manipulation och händelsehantering är centralt för frontend-utveckling med JavaScript.
